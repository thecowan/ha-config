- id: '1527922079178'
  alias: Paul Bathroom Button
  trigger:
  - event_data:
      click_type: single
      entity_id: binary_sensor.wall_switch_left_bathroom
    event_type: xiaomi_aqara.click
    platform: event
  condition: []
  action:
  - service: script.shower_paul
- id: '1527925880014'
  alias: Play/Pause Ensuite
  trigger:
  - event_data:
      click_type: both
      entity_id: binary_sensor.wall_switch_both_bathroom
    event_type: xiaomi_aqara.click
    platform: event
  condition: []
  action:
  - data:
      entity_id: media_player.bathroom
    service: media_player.media_play_pause
- id: '1528768127918'
  alias: 'Sonos: Switch Loungeroom amp when active'
  trigger:
  - entity_id: media_player.lounge
    from: paused
    platform: state
    to: playing
  condition: []
  action:
  - data:
      entity_id: automation.receiver_update_last_state
    service: automation.turn_off
  - data:
      entity_id: media_player.receiver
    service: media_player.turn_on
  - timeout: 00:00:10
    wait_template: '{{ is_state(''media_player.receiver'', ''on'') }}'
  - data:
      entity_id: media_player.receiver
      source: Video2
    service: media_player.select_source
  - data:
      entity_id: media_player.receiver
      volume_level: 0.825
    service: media_player.volume_set
- id: '1528777053684'
  alias: 'Receiver: update last state'
  trigger:
  - entity_id: media_player.receiver
    platform: state
  condition:
  - condition: template
    value_template: '{{ trigger.to_state.attributes.source not in ["Sonos", "video2_cbl_sat"]  }}'
  action:
  - data:
      value_template: '{{ states("media_player.receiver") }}'
      entity_id: var.receiver_last_state
    service: var.set
  - data:
      value_template: '{% if is_state("media_player.receiver", "on") -%}{{ state_attr("media_player.receiver",
        "source") | regex_replace("_.*", "") | regex_replace("^video", "Video") }}{%-
        else -%}{{ states("variable.receiver_last_source") }}{%- endif %}'
      entity_id: var.receiver_last_source
    service: var.set
  - data:
      value_template: '{% if is_state("media_player.receiver", "on") -%}{{ state_attr("media_player.receiver",
        "volume_level") }}{%- else -%}{{ states("variable.receiver_last_volume") }}{%-
        endif %}'
      entity_id: receiver_last_volume
    service: var.set
- id: '1528780901218'
  alias: 'Sonos: Switch loungeroom back after finished'
  trigger:
  - entity_id: media_player.lounge
    from: playing
    platform: state
    to: paused
  condition: []
  action:
  - data_template:
      entity_id: media_player.receiver
      volume_level: '{{ states("var.receiver_last_volume") }}'
    service: media_player.volume_set
  - data_template:
      entity_id: media_player.receiver
      source: '{{ states("var.receiver_last_source") }}'
    service: media_player.select_source
  - data_template:
      entity_id: '{% if is_state("var.receiver_last_state", "off") -%}media_player.receiver{%-
        else -%}dummy.dummy{%- endif -%}'
    service: media_player.turn_off
  - delay:
      seconds: 20
  - data:
      entity_id: automation.receiver_update_last_state
    service: automation.turn_on
- id: '1546980843431'
  alias: Paul Arrive Home
  trigger:
  - entity_id: device_tracker.pauls_pixel_6_pro
    from: not_home
    platform: state
    to: home
  condition:
  - condition: state
    entity_id: group.kids_presence
    state: not_home
  action:
  - service: light.turn_on
  - service: script.sonos_get_home
- id: '1546984412841'
  alias: Paul Leave Home
  trigger:
  - entity_id: device_tracker.pauls_pixel_6_pro
    platform: state
    from: home
    to: not_home
    for:
      minutes: 10
  condition: []
  action:
  - service: media_player.media_pause
  - service: light.turn_off
- id: '1621316877856'
  alias: 'Tasmota Discovery: Aroma Diffuser 1'
  description: ''
  use_blueprint:
    path: tasmota/discovery-tuya_diffuser_fan_and_error_sensor.yaml
    input:
      name: diffuser1
      topic: tasmota_1229CD
      mac_address: 4C:11:AE:12:29:CD
- id: '1621318073028'
  alias: 'Tasmota Discovery: Aroma Diffuser 2'
  description: ''
  use_blueprint:
    path: tasmota/discovery-tuya_diffuser_fan_and_error_sensor.yaml
    input:
      name: diffuser2
      topic: tasmota_1222E9
      mac_address: 4C:11:AE:12:22:E9
- id: '1622424964423'
  alias: "\U0001F431 Update Cat Flap State from Cloud"
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.cat_flap_cloud_state
  - platform: homeassistant
    event: start
  condition: []
  action:
  - service: input_select.select_option
    target:
      entity_id: input_select.cat_flap_state
    data:
      option: '{{ states("sensor.cat_flap_cloud_state") }}'
  mode: single
- id: '1622457098699'
  alias: Push Cat Flap State to Cloud
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.cat_flap_state
  condition:
  - condition: template
    value_template: '{{ states(''input_select.cat_flap_state'') != states(''sensor.cat_flap_cloud_state'')
      }}'
  action:
  - service: system_log.write
    data:
      message: Firing due to change to {{ states('input_select.cat_flap_state') }}
        vs cloud state {{ states('sensor.cat_flap_cloud_state') }}
  - service: script.set_cat_flap_state
    data:
      target_state: '{{ states("input_select.cat_flap_state") }}'
  mode: single
- id: '1622457601269'
  alias: "\U0001F431  Keep cats in Bedroom at Night"
  description: ''
  trigger:
  - platform: time
    at: '22:00:00'
  condition: []
  action:
  - service: input_select.select_option
    target:
      entity_id: input_select.cat_flap_state
    data:
      option: keep_in_office
  mode: single
- id: '1622457637235'
  alias: "\U0001F431 Let cats out in morning"
  description: ''
  trigger:
  - platform: time
    at: 05:00:00
  condition: []
  action:
  - service: input_select.select_option
    target:
      entity_id: input_select.cat_flap_state
    data:
      option: all_unlocked
  mode: single
- id: '1622631147055'
  alias: Pause Overnight Music
  description: ''
  trigger:
  - platform: time
    at: 05:00
  condition: []
  action:
  - service: media_player.media_pause
    target:
      entity_id:
      - media_player.master_bedroom
      - media_player.guest_room
  mode: single
- id: '1622693720246'
  alias: "\U0001F6CE️  Doorbell Reaction"
  description: ''
  trigger:
  - platform: event
    event_type: xiaomi_aqara.click
    event_data:
      click_type: single
      entity_id: binary_sensor.front_doorbell_button
  condition: []
  action:
  - service: yeelight.set_color_flow_scene
    data:
      entity_id: light.yeelight_livingroom
      count: 2
      action: recover
      transitions:
      - HSVTransition:
        - 180
        - 100
        - 100
        - 80
      - HSVTransition:
        - 180
        - 100
        - 250
        - 1
  mode: single
- id: '1622697978346'
  alias: test both
  description: ''
  trigger:
  - device_id: b9bb1e104f88289e6cd8a17ce2b3eeb4
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: both_buttons
  condition: []
  action:
  - service: logbook.log
    data:
      name: aa
      message: boo double
  mode: single
- id: '1622700041681'
  alias: '**TEST* button'
  description: ''
  trigger:
  - device_id: 937ffa395d66f28b51bde7ff03f3e77e
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: remote_button_short_press
  condition: []
  action:
  - service: light.toggle
    target:
      entity_id: light.yeelight_livingroom
    data:
      kelvin: 3200
      brightness_pct: 80
  mode: single
- id: '1622700231745'
  alias: '**TEST* button 2'
  description: ''
  trigger:
  - device_id: 937ffa395d66f28b51bde7ff03f3e77e
    domain: zha
    platform: device
    type: remote_button_double_press
    subtype: remote_button_double_press
  condition: []
  action:
  - service: light.turn_on
    target:
      entity_id: light.yeelight_livingroom
    data:
      effect: LSD
  mode: single
- id: '1624282422729'
  alias: Telegram test
  description: ''
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
      command: /hi
  condition: []
  action:
  - service: telegram_bot.send_message
    data:
      message: Hi yourself, {{ trigger.event.data["from_first"] }}!
      target: '{{ trigger.event.data.chat_id }}'
  mode: single
- id: '1624101614357'
  alias: "\U0001F518 Toggle Outside Lights"
  description: ''
  trigger:
  - device_id: ab450a7b3d8039f7716d894b38bf16e6
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: remote_button_short_press
  condition: []
  action:
  - service: light.toggle
    target:
      entity_id: light.outside_globes
    data: {}
  mode: single
- id: '1624283044736'
  alias: Telegram Home
  description: ''
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
      command: /digest
  condition: []
  action:
  - service: telegram_bot.send_message
    data:
      message: "\U0001F321️ Living Room Temp = {{ states(\"sensor.living_room_temperature\")
        }}°C \n\U0001F321 Outside Temp = {{ states(\"sensor.outside_temperature\")
        }}°C\n\U0001F324 Weather = {{ states(\"sensor.lilyfield_short_text_0\") }}
        (tomorrow {{ states(\"sensor.lilyfield_short_text_1\") }})\n\U0001F327️ Chance
        of rain = {{ states(\"sensor.lilyfield_rain_chance_0\") }}% (tomorrow {{ states(\"sensor.lilyfield_rain_chance_1\")
        }}%)"
      target: '{{ trigger.event.data.chat_id }}'
  mode: single
- id: '1624503867808'
  alias: "\U0001F518 Toggle Party Lights"
  description: ''
  trigger:
  - device_id: ab450a7b3d8039f7716d894b38bf16e6
    domain: zha
    platform: device
    type: remote_button_double_press
    subtype: remote_button_double_press
  condition: []
  action:
  - service: light.toggle
    target:
      entity_id: light.flux_party
    data:
      effect: colorloop
  mode: single
- id: '1629256775832'
  alias: ⚡ Dishwasher Running
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.dishwasher_power
    above: '50'
  condition:
  - condition: state
    entity_id: input_select.dishwasher_state
    state: Idle
  action:
  - service: input_select.select_option
    target:
      entity_id: input_select.dishwasher_state
    data:
      option: Running
  mode: single
- id: '1629257243979'
  alias: ⚡ Dishwasher Finished
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.dishwasher_power
    below: '5'
  condition:
  - condition: state
    entity_id: input_select.dishwasher_state
    state: Running
  action:
  - service: input_select.select_option
    target:
      entity_id: input_select.dishwasher_state
    data:
      option: Finished
  mode: single
- id: '1633580036748'
  alias: "\U0001FA9F  Blinds: Close at Sunset or designated time"
  description: ''
  trigger:
  - platform: sun
    event: sunset
  - platform: time
    at: input_datetime.blind_close_time
  condition: []
  action:
  - service: cover.close_cover
    data: {}
    target:
      entity_id: cover.living_room_blind
  mode: single
- id: '1633601876342'
  alias: "\U0001FA9F  Blinds: Open in the Morning"
  description: ''
  trigger:
  - platform: time
    at: input_datetime.blind_open_time
  condition: []
  action:
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.living_room_blind
  mode: single
- id: '1634176799507'
  alias: "\U0001F3A5 Turn Selfie Light on when meeting starts"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.cow_mabookpro_in_meeting
    to: 'on'
  condition: []
  action:
  - service: light.turn_on
    data:
      color_temp: 100
      brightness_pct: 100
    target:
      entity_id: light.office_ring_light
  mode: single
- id: '1634179680814'
  alias: "\U0001F3A5 Turn Selfie Light off when meeting ends"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.cow_mabookpro_in_meeting
    to: 'off'
  condition: []
  action:
  - service: light.turn_off
    target:
      entity_id: light.office_ring_light
    data: {}
  mode: single
- id: '1638313007824'
  alias: "\U0001F518 Office Magic Cube"
  description: ''
  use_blueprint:
    path: Mikkelmoeller/aqara-magic-cube-zha-51-actions.yaml
    input:
      remote: 32aee9b615dfbf3b485c18093910afed
      rotate_right:
      - service: media_player.volume_up
        target:
          entity_id: media_player.office
        data: {}
      rotate_left:
      - service: media_player.volume_down
        target:
          entity_id: media_player.office
        data: {}
      knock_any_side: true
      cube_knock_any:
      - service: media_player.media_play_pause
        target:
          entity_id: media_player.office
        data: {}
      cube_flip_180:
      - service: media_player.media_previous_track
        target:
          entity_id: media_player.office
        data: {}
      flip_180: true
      flip_90: true
      cube_flip_90:
      - service: media_player.media_next_track
        target:
          entity_id: media_player.office
        data: {}
      cube_shake:
      - service: script.sonos_play_matching
        data:
          entity_id: media_player.office
          match: \U0001F42E
- id: '1639972602920'
  alias: "\U0001F3A5 Office meeting begin/change"
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.busy_light_colour
    to:
    - blue
    - red
    - green
  condition:
  - condition: state
    entity_id: binary_sensor.cow_macbookpro_docked_in_office
    state: 'on'
  action:
  - service: light.turn_on
    target:
      entity_id: light.office_busy_light
    data:
      color_name: '{{ trigger.to_state.state }}'
  mode: single
- id: '1639974205992'
  alias: "\U0001F3A5 Office meeting end"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.busy_light_colour
    to: free
    for:
      hours: 0
      minutes: 0
      seconds: 10
  condition:
  - condition: state
    entity_id: binary_sensor.cow_macbookpro_docked_in_office
    state: 'on'
  action:
  - if:
    - condition: state
      entity_id: input_text.resume_office_music_when_meeting_ends
      state: 'True'
    then:
    - service: media_player.media_play
      data: {}
      target:
        entity_id: media_player.office
    else:
    - service: notify.mobile_app_pixel_6_pro
      data:
        message: Resume/play office music?
        title: Meeting ended?
        data:
          actions:
          - action: RESUME_OFFICE
            title: Resume
          - action: IGNORE
            title: Ignore
  - service: light.turn_off
    target:
      entity_id: light.office_busy_light
    data: {}
  mode: single
- id: '1640079011445'
  alias: Populate Light Effects
  description: ''
  trigger:
  - platform: state
    entity_id:
    - light.hedge
    - light.porch
    - light.porch_inside
    - light.front_window
    attribute: effect_list
  - platform: state
    entity_id:
    - light.hedge
    - light.porch
    - light.porch_inside
    - light.front_window
    attribute: effect
  condition: []
  action:
  - service: input_select.set_options
    target:
      entity_id: '{% if trigger.entity_id == "light.hedge" %}input_select.hedge_effect{%
        elif trigger.entity_id == "light.porch" %}input_select.porch_effect% elif
        trigger.entity_id == "light.porch_inside" %}input_select.porch_inside_effect{%
        elif trigger.entity_id == "light.front_window" %}input_select.front_window_effect{%
        endif %}'
    data:
      options: '{{ state_attr(trigger.entity_id, "effect_list") }}'
  - service: input_select.select_option
    target:
      entity_id: '{% if trigger.entity_id == "light.hedge" %}input_select.hedge_effect{%
        elif trigger.entity_id == "light.porch" %}input_select.porch_effect{% elif
        trigger.entity_id == "light.porch_inside" %}input_select.porch_inside_effect{%
        elif trigger.entity_id == "light.front_window" %}input_select.front_window_effect{%
        endif %}'
    data:
      option: '{{ state_attr(trigger.entity_id, "effect") }}'
  mode: single
- id: '1640079960037'
  alias: Publish Light Effects
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_select.hedge_effect
    - input_select.porch_effect
    - input_select.porch_inside_effect
    - input_select.front_window_effect
  condition: []
  action:
  - service: light.turn_on
    target:
      entity_id: '{% if trigger.entity_id == "input_select.hedge_effect" %}light.hedge{%
        elif trigger.entity_id == "input_select.porch_effect" %}light.porch{% elif
        trigger.entity_id == "input_select.porch_inside_effect" %}light.porch_inside{%
        elif trigger.entity_id == "input_select.front_window_effect" %}light.front_window{%
        endif %}'
    data:
      effect: '{{ trigger.to_state.state }}'
  mode: single
- id: '1640131452644'
  alias: Christmas Lights Turn On
  description: ''
  trigger:
  - platform: sun
    event: sunset
    offset: '0'
  condition: []
  action:
  - service: light.turn_on
    target:
      entity_id:
      - light.porch
      - light.front_window
      - light.hedge
  - type: turn_on
    device_id: b7dd81ddd22fb9e355cdc312d2b57671
    entity_id: switch.porch_sync_send
    domain: switch
  - type: turn_on
    device_id: 988468d81e8fc1a0c9af30b2264c608a
    entity_id: switch.front_window_sync_receive
    domain: switch
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - device_id: fba657a300c488982877bea85936a7c4
    domain: select
    entity_id: select.hedge_playlist
    type: select_option
    option: Christmas Playlist
  - device_id: b7dd81ddd22fb9e355cdc312d2b57671
    domain: select
    entity_id: select.porch_playlist
    type: select_option
    option: Christmas Mix
  mode: single
- id: '1643507370583'
  alias: Turn off Ring Light Colour when Ring Light White on
  description: ''
  trigger:
  - platform: state
    entity_id: light.office_ring_light_white
    to: 'on'
  condition: []
  action:
  - service: light.turn_off
    target:
      entity_id: light.office_ring_light_colour
  mode: single
- id: '1643507502308'
  alias: Turn off Ring Light White when Ring Light Colour on
  description: ''
  trigger:
  - platform: state
    entity_id: light.office_ring_light_colour
    to: 'on'
  condition: []
  action:
  - service: light.turn_off
    target:
      entity_id:
      - light.office_ring_light_white
  mode: single
- id: '1643532214796'
  alias: Update last ring light state
  description: ''
  trigger:
  - platform: state
    entity_id: light.office_ring_light_colour
    to: 'on'
  - platform: state
    entity_id: light.office_ring_light_white
    to: 'on'
  condition: []
  action:
  - service: input_text.set_value
    target:
      entity_id: input_text.office_ring_light_last_mode
    data:
      value: '{{ trigger.entity_id }}'
  mode: single
- id: '1647647743141'
  alias: "\U0001F518 4 Button Scene Switch - Backdoor"
  description: ''
  use_blueprint:
    path: Stringer/zigbee2mqtt-tuya-4-button-scene-switch-ts0044.yaml
    input:
      switch: sensor.zemismart_scene_switch_1_action
      button_one_short_press:
      - service: light.toggle
        target:
          entity_id: light.yeelight_office
        data: {}
      button_two_short_press:
      - service: light.toggle
        target:
          entity_id: light.yeelight_office
        data: {}
      button_three_short_press:
      - service: light.toggle
        target:
          entity_id: light.yeelight_office
        data: {}
      button_four_short_press:
      - service: light.toggle
        target:
          entity_id: light.yeelight_office
        data: {}
- id: '1647660898416'
  alias: '**TEST* 4-gang'
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.zemismart_scene_switch_1_action
  condition: []
  action:
  - service: logbook.log
    data:
      name: fooo
      message: button {{trigger.to_state.state}}
  mode: single
- id: '1652232659373'
  alias: Office Light Switch - Companion App
  description: ''
  trigger:
  - platform: event
    event_type: ios.action_fired
    event_data:
      actionID: F5BB456E-1E51-4E91-A906-B94363DEB4F8
  condition: []
  action:
  - service: light.toggle
    data: {}
    target:
      entity_id: light.yeelight_office
  mode: single
- id: '1652661275277'
  alias: "\U0001F3A5 Office meeting begin"
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.busy_light_colour
    from: free
  condition:
  - condition: state
    entity_id: binary_sensor.cow_macbookpro_docked_in_office
    state: 'on'
  action:
  - service: input_text.set_value
    data:
      value: '{{ is_state("media_player.office", "playing") and ((state_attr("media_player.office",
        "group_members") | default(''X'', true) | length) == 1) }}'
    target:
      entity_id: input_text.resume_office_music_when_meeting_ends
  - service: media_player.media_pause
    data: {}
    target:
      device_id: 4e62a9a2822e4b42b15dceb3fa53ed28
  mode: single
- id: '1652675530780'
  alias: Play/Pause Office - Companion App
  description: ''
  trigger:
  - platform: event
    event_type: ios.action_fired
    event_data:
      actionID: 755F5E0B-63A8-49BA-874F-92D5D43EF2A7
  condition: []
  action:
  - service: media_player.media_play_pause
    data: {}
    target:
      entity_id: media_player.office
  mode: single
- id: '1653435612829'
  alias: Respond to Office Resume Notification
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: RESUME_OFFICE
  condition: []
  action:
  - service: media_player.media_play
    data: {}
    target:
      entity_id: media_player.office
  mode: single
- id: '1653519007739'
  alias: "\U0001F3B5 Scrobble Office Tracks"
  description: ''
  trigger:
  - platform: event
    event_type: state_changed
    event_data:
      entity_id: media_player.office
  condition:
  - condition: template
    value_template: '{{ trigger.event.data[''new_state''][''state''] == ''playing''
      or trigger.event.data[''old_state''][''state''] == ''playing'' }}'
  - condition: template
    value_template: "{{ ((state_attr(\"media_player.office\", \"group_members\") |
      default('X', true) |\n    length) == 1) }}"
  - condition: state
    entity_id: binary_sensor.cow_macbookpro_docked_in_office
    state: 'on'
  action:
  - service: shell_command.process_mpd_data
    data:
      mpd_data: "'{{\n  {\n  \"old_state\": {\"media_content_type\": trigger.event.data['old_state']['attributes']['media_content_type']
        | default(\"\"),\n                \"media_content_id\": trigger.event.data['old_state']['attributes']['media_content_id']
        | default(\"\"),\n                \"media_position_updated_at\": as_timestamp(trigger.event.data['old_state']['attributes']['media_position_updated_at'])
        | timestamp_custom('%Y-%m-%dT%H:%M:%S.%f%z',False) | default(\"\"),\n                \"media_title\":
        trigger.event.data['old_state']['attributes']['media_title'] | default(\"\")
        | replace(\"'\",\"\"),\n                \"media_artist\": trigger.event.data['old_state']['attributes']['media_artist']
        | default(\"\") | replace(\"'\",\"\"),\n                \"media_duration\":
        trigger.event.data['old_state']['attributes']['media_duration'] | default(\"\"),\n
        \               \"media_position\": trigger.event.data['old_state']['attributes']['media_position']
        | default(\"\"),\n                \"media_track\": trigger.event.data['old_state']['attributes']['media_track']
        | default(\"\"),\n                \"media_album_name\": trigger.event.data['old_state']['attributes']['media_album_name']
        | default(\"\"),\n                \"media_album_artist\": trigger.event.data['old_state']['attributes']['media_album_artist']
        | default(\"\"),\n                \"source\": trigger.event.data['old_state']['attributes']['source']
        | default(\"\"),\n                \"friendly_name\": trigger.event.data['old_state']['attributes']['friendly_name']
        | default(\"\"),\n                \"entity_picture\": trigger.event.data['old_state']['attributes']['entity_picture']
        | default(\"\"),\n                \"queue_position\": trigger.event.data['old_state']['attributes']['queue_position']
        | default(\"\"),\n                \"queue_size\": trigger.event.data['old_state']['attributes']['queue_size']
        | default(\"\"),\n                \"media_channel\": trigger.event.data['old_state']['attributes']['media_channel']
        | default(\"\") | replace(\"'\",\"\"),\n                \"source_list\": trigger.event.data['old_state']['attributes']['source_list']
        | default(\"\")\n               },\n  \"new_state\": {\"media_content_type\":
        trigger.event.data['new_state']['attributes']['media_content_type'] | default(\"\"),\n
        \               \"media_content_id\": trigger.event.data['new_state']['attributes']['media_content_id']
        | default(\"\"),\n                \"media_position_updated_at\": as_timestamp(trigger.event.data['new_state']['attributes']['media_position_updated_at'])
        | timestamp_custom('%Y-%m-%dT%H:%M:%S.%f%z',False) | default(\"\"),\n                \"media_title\":
        trigger.event.data['new_state']['attributes']['media_title'] | default(\"\")
        | replace(\"'\",\"\"),\n                \"media_artist\": trigger.event.data['new_state']['attributes']['media_artist']
        | default(\"\") | replace(\"'\",\"\"),\n                \"media_duration\":
        trigger.event.data['new_state']['attributes']['media_duration'] | default(\"\"),\n
        \               \"media_position\": trigger.event.data['new_state']['attributes']['media_position']
        | default(\"\"),\n                \"media_track\": trigger.event.data['new_state']['attributes']['media_track']
        | default(\"\"),\n                \"media_album_name\": trigger.event.data['new_state']['attributes']['media_album_name']
        | default(\"\"),\n                \"media_album_artist\": trigger.event.data['new_state']['attributes']['media_album_artist']
        | default(\"\"),\n                \"source\": trigger.event.data['new_state']['attributes']['source']
        | default(\"\"),\n                \"friendly_name\": trigger.event.data['new_state']['attributes']['friendly_name']
        | default(\"\"),\n                \"entity_picture\": trigger.event.data['new_state']['attributes']['entity_picture']
        | default(\"\"),\n                \"queue_position\": trigger.event.data['new_state']['attributes']['queue_position']
        | default(\"\"),\n                \"queue_size\": trigger.event.data['new_state']['attributes']['queue_size']
        | default(\"\"),\n                \"media_channel\": trigger.event.data['new_state']['attributes']['media_channel']
        | default(\"\") | replace(\"'\",\"\"),\n                \"source_list\": trigger.event.data['new_state']['attributes']['source_list']
        | default(\"\")\n               },\n   \"time_new\": as_timestamp(trigger.event.data['new_state']['last_updated'])
        | timestamp_custom('%Y-%m-%dT%H:%M:%S.%f%z',False),\n   \"time_old\": as_timestamp(trigger.event.data['old_state']['last_updated'])
        | timestamp_custom('%Y-%m-%dT%H:%M:%S.%f%z',False),\n   \"state_new\": trigger.event.data['new_state']['state'],\n
        \  \"state_old\": trigger.event.data['old_state']['state']\n   } | to_json\n}}'\n"
  mode: single
- id: '1654515497943'
  alias: "\U0001F4E2 Alert during High Alert Mode"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.guest_room_door
    - binary_sensor.dots_office_door
    - binary_sensor.bedroom_door
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.high_alert_mode
    state: 'on'
  action:
  - service: notify.mobile_app_cow_s_macbook_pro
    data:
      message: Alert {{ trigger.entity_id }}
      title: Alert!
  - service: notify.mobile_app_pixel_6_pro
    data:
      message: Alert {{ trigger.entity_id }}
      title: Alert!
  - service: notify.kodi_cow_macbookpro
    data:
      message: Alert {{ trigger.entity_id }}
      title: Alert!
  - service: media_player.media_stop
    data: {}
    target:
      entity_id: media_player.kodi_cows_macbook_pro
  - service: kodi.call_method
    data:
      method: Input.Home
    target:
      entity_id: media_player.kodi_cows_macbook_pro
  mode: single
- id: '1654517529638'
  alias: "\U0001F4E2 Enter High Alert Mode"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - media_player.kodi_cows_macbook_pro
    to: playing
  condition:
  - condition: state
    entity_id: input_boolean.high_alert_mode
    state: 'off'
  action:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.high_alert_mode
  - service: notify.kodi_cow_macbookpro
    data:
      message: Entering High Alert Mode
      title: High Alert
  mode: single
- id: '1654517690774'
  alias: "\U0001F4E2 Exit High Alert Mode"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - media_player.kodi_cows_macbook_pro
    from: playing
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id:
    - media_player.kodi_cows_macbook_pro
    to: unavailable
  - platform: state
    entity_id:
    - media_player.kodi_cows_macbook_pro
    to: 'off'
  condition:
  - condition: state
    entity_id: input_boolean.high_alert_mode
    state: 'on'
  action:
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.high_alert_mode
  - service: notify.kodi_cow_macbookpro
    data:
      message: Leaving High Alert Mode
      title: High Alert
  mode: single
- id: '1654521196420'
  alias: 'Button Test: MQTT Lumi Button 3'
  description: ''
  use_blueprint:
    path: Drafted/aqara-buttons-all-in-one-zigbee2mqtt.yaml
    input:
      action_sensor: sensor.lumi_switch_3_action
      single_action:
      - service: light.toggle
        data:
          color_temp: 309
        target:
          entity_id: light.rear_floodlight
      double_action:
      - service: input_select.select_next
        data: {}
        target:
          entity_id: input_select.read_floodlight_colour_cycle
      - if:
        - condition: state
          entity_id: input_select.read_floodlight_colour_cycle
          state:
          - warm
          - neutral
          - cool
        then:
        - service: light.turn_on
          data:
            color_temp: 300
          target:
            entity_id: light.rear_floodlight
        else:
        - service: light.turn_on
          data:
            color_name: '{{ states("input_select.read_floodlight_colour_cycle") }}'
          target:
            entity_id: light.rear_floodlight
      triple_action:
      - service: notify.mobile_app_cow_s_macbook_pro
        data:
          message: 'Click: triple'
      quadruple_action:
      - service: notify.mobile_app_cow_s_macbook_pro
        data:
          message: 'Click: quadruple!'
      hold_action:
      - service: notify.mobile_app_cow_s_macbook_pro
        data:
          message: Hold
      shake_action: []
- id: '1654644534445'
  alias: Start workday in office
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.cow_macbook_pro_active
    to: 'on'
  condition:
  - condition: template
    value_template: '{{ as_timestamp(state_attr(''automation.start_workday_in_office'',''last_triggered''))|timestamp_custom(''%Y.%j'')
      != as_timestamp(now())|timestamp_custom(''%Y.%j'') }}'
  action:
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.office
        state: playing
    then:
    - service: notify.mobile_app_pixel_6_pro
      data:
        message: Resume/play office music?
        title: Workday beginning!
        data:
          actions:
          - action: RESUME_OFFICE
            title: Resume
          - action: SHUFFLE_OFFICE
            title: Shuffle
          - action: IGNORE
            title: Ignore
  mode: single
- id: '1654648261134'
  alias: Respond to Office Shuffle Notification
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: SHUFFLE_OFFICE
  condition: []
  action:
  - service: media_player.unjoin
    data: {}
    target:
      entity_id: media_player.office
  - service: script.sonos_play_matching
    data:
      entity_id: media_player.office
      match: "\U0001F3E0"
  mode: single
- id: '1654755382943'
  alias: Leave Home without Dogs
  description: ''
  trigger:
  - platform: mqtt
    topic: /foo/bar
  condition: []
  action:
  - service: media_player.play_media
    target:
      entity_id: media_player.office
    data:
      media_content_id: media-source://radio_browser/961a0451-0601-11e8-ae97-52543be04c81
      media_content_type: audio/aac
    metadata:
      title: ABC Local Radio 702 Sydney (AAC)
      thumbnail: http://www.abc.net.au/cm/rimage/7893524-1x1-large.png?v=6
      media_class: music
      children_media_class:
      navigateIds:
      - {}
      - media_content_type: app
        media_content_id: media-source://radio_browser
      - media_content_type: music
        media_content_id: media-source://radio_browser/country/AU
  mode: single
- id: '1654777172274'
  alias: "\U0001F518 Office Opple 6-button [new]"
  description: ''
  use_blueprint:
    path: cow/zigbee2mqtt-z2m-aqara-opple-6-button-remote-3-bands-wxcjkg13lm.yaml
    input:
      switch: sensor.office_opple_6_button_action
      button_1_single:
      - service: light.toggle
        target:
          entity_id: light.yeelight_office
        data: {}
      button_1_triple:
      - service: fan.toggle
        target:
          entity_id: fan.office_diffuser
        data: {}
      button_3_single:
      - service: media_player.volume_down
        target:
          entity_id: media_player.office
        data: {}
      button_3_double:
      - service: media_player.media_previous_track
        target:
          entity_id: media_player.office
        data: {}
      button_3_hold:
      - service: media_player.media_play_pause
        target:
          entity_id: media_player.office
        data: {}
      button_4_single:
      - service: media_player.volume_up
        target:
          entity_id: media_player.office
        data: {}
      button_4_double:
      - service: media_player.media_next_track
        target:
          entity_id: media_player.office
        data: {}
      button_4_hold:
      - service: media_player.unjoin
        target:
          entity_id: media_player.office
        data: {}
      - service: media_player.clear_playlist
        target:
          entity_id: media_player.office
        data: {}
      - service: media_player.shuffle_set
        data:
          shuffle: true
        target:
          entity_id: media_player.office
      - service: script.sonos_play_matching
        data:
          entity_id: media_player.office
          match: \U0001F42E
      button_5_single:
      - type: brightness_decrease
        device_id: 8a466522fced3aa1009b180e4be85ada
        entity_id: light.yeelight_office
        domain: light
      button_5_double:
      - service: light.turn_on
        target:
          entity_id: light.yeelight_office
        data:
          color_temp: '{{ max(state_attr("light.yeelight_office", "color_temp")|int
            - 20, state_attr("light.yeelight_office", "min_mireds")|int) }}'
      button_5_hold:
      - service: light.turn_off
        target:
          entity_id: light.yeelight_office
        data: {}
      button_6_single:
      - type: brightness_increase
        device_id: 8a466522fced3aa1009b180e4be85ada
        entity_id: light.yeelight_office
        domain: light
      button_6_double:
      - service: light.turn_on
        target:
          entity_id: light.yeelight_office
        data:
          color_temp: '{{ min(state_attr("light.yeelight_office", "color_temp")|int
            + 20, state_attr("light.yeelight_office", "max_mireds")|int) }}'
      button_6_hold:
      - service: light.turn_on
        data:
          brightness_pct: 100
          color_temp: 299
        target:
          entity_id: light.yeelight_office
- id: '1654780302456'
  alias: Aqara Magic Cube Zigbee2MQTT - 2022-05-05
  description: ''
  use_blueprint:
    path: SirGoodenough/Zigbee2MQTT - Xiaomi Cube Controller.yaml
    input:
      rotate_cw_face_0:
      - service: media_player.volume_up
        data: {}
        target:
          entity_id: media_player.office
      remote: sensor.office_aqara_cube_action
      rotate_ccw_face_0:
      - service: media_player.volume_down
        data: {}
        target:
          entity_id: media_player.office
      rotate_cw_face_4:
      - device_id: 8a466522fced3aa1009b180e4be85ada
        domain: light
        entity_id: light.yeelight_office
        type: brightness_increase
      rotate_ccw_face_4:
      - device_id: 8a466522fced3aa1009b180e4be85ada
        domain: light
        entity_id: light.yeelight_office
        type: brightness_decrease
- id: '1654913530731'
  alias: "\U0001F518 Bedside Button Left [New]"
  description: ''
  use_blueprint:
    path: cow/aqara-buttons-all-in-one-zigbee2mqtt.yaml
    input:
      action_sensor: sensor.bedroom_button_left_action
      single_action:
      - service: light.toggle
        data: {}
        target:
          entity_id:
          - light.bedside_lamps
      double_action:
      - service: light.turn_off
        data: {}
        target:
          area_id: master_bedroom
      - service: script.sonos_sleep
        data: {}
- id: '1654914108142'
  alias: "\U0001F518 Bedside Button Right [New]"
  description: ''
  use_blueprint:
    path: cow/aqara-buttons-all-in-one-zigbee2mqtt.yaml
    input:
      action_sensor: sensor.bedroom_button_right_action
      single_action:
      - service: light.toggle
        data: {}
        target:
          entity_id:
          - light.bedside_lamps
      double_action:
      - service: light.turn_off
        data: {}
        target:
          area_id: master_bedroom
- id: '1654949497784'
  alias: "\U0001F518 Back Door Button"
  description: ''
  use_blueprint:
    path: cow/aqara-buttons-all-in-one-zigbee2mqtt.yaml
    input:
      action_sensor: sensor.back_door_button_action
      single_action:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.outside_globes
      double_action:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.rear_floodlight
- id: '1654949993985'
  alias: "\U0001F518 Office Button"
  description: ''
  use_blueprint:
    path: cow/aqara-buttons-all-in-one-zigbee2mqtt.yaml
    input:
      action_sensor: sensor.office_button_action
      single_action:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.yeelight_office
- id: '1656386610707'
  alias: "\U0001F321️ Dot's Office Heater Timer - On"
  description: ''
  trigger:
  - platform: time
    at: input_datetime.dots_office_heater_on_time
  condition:
  - condition: state
    entity_id: climate.dots_office_heating
    state: heat
  - condition: state
    entity_id: input_boolean.dots_office_heater_timer
    state: 'on'
  action:
  - service: climate.set_preset_mode
    data:
      preset_mode: sleep
    target:
      entity_id: climate.dots_office_heating
  - service: climate.set_temperature
    target:
      entity_id: climate.dots_office_heating
    data:
      temperature: '{{ states("input_number.dots_office_heater_timer_temp") }}'
    enabled: false
  mode: single
- id: '1656386656506'
  alias: "\U0001F321️ Dot's Office Heater Timer - Off"
  description: ''
  trigger:
  - platform: time
    at: input_datetime.dots_office_heater_off_time
  condition:
  - condition: state
    entity_id: climate.dots_office_heating
    state: sleep
    attribute: preset_mode
  - condition: state
    entity_id: input_boolean.dots_office_heater_timer
    state: 'on'
  action:
  - service: climate.set_preset_mode
    data:
      preset_mode: none
    target:
      entity_id: climate.dots_office_heating
  mode: single
- id: '1656388617944'
  alias: "\U0001F321️️ Dot's Office Heater - Sleep Mode Slider"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - climate.dots_office_heating
    attribute: preset_mode
    to: sleep
  condition: []
  action:
  - service: climate.set_temperature
    target:
      entity_id: climate.dots_office_heating
    data:
      temperature: '{{ states("input_number.dots_office_heater_timer_temp") }}'
  mode: single
- id: '1656500026360'
  alias: "\U0001F321️️ Bedroom Heater - Sleep Mode Slider"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - climate.bedroom_heating
    attribute: preset_mode
    to: sleep
  condition: []
  action:
  - service: climate.set_temperature
    target:
      entity_id: climate.bedroom_heating
    data:
      temperature: '{{ states("input_number.bedroom_heater_timer_temp") }}'
  mode: single
- id: '1656500453233'
  alias: "\U0001F321️ Bedroom Heater Timer - Off "
  description: ''
  trigger:
  - platform: time
    at: input_datetime.bedroom_heater_off_time
  condition:
  - condition: state
    entity_id: climate.bedroom_heating
    state: sleep
    attribute: preset_mode
  - condition: state
    entity_id: input_boolean.bedroom_heater_timer
    state: 'on'
  action:
  - service: climate.set_preset_mode
    data:
      preset_mode: none
    target:
      entity_id:
      - climate.bedroom_heating
  mode: single
- id: '1656500556853'
  alias: "\U0001F321️ Bedroom Heater Timer - On"
  description: ''
  trigger:
  - platform: time
    at: input_datetime.bedroom_heater_on_time
  condition:
  - condition: state
    entity_id: climate.bedroom_heating
    state: heat
  - condition: state
    entity_id: input_boolean.bedroom_heater_timer
    state: 'on'
  action:
  - service: climate.set_preset_mode
    data:
      preset_mode: sleep
    target:
      entity_id:
      - climate.bedroom_heating
  mode: single
- id: '1656501733821'
  alias: "\U0001F321️ Office Heater Timer - Off"
  description: ''
  trigger:
  - platform: time
    at: input_datetime.office_heater_off_time
  condition:
  - condition: state
    entity_id: climate.office_heating
    state: sleep
    attribute: preset_mode
  - condition: state
    entity_id: input_boolean.office_heater_timer
    state: 'on'
  action:
  - service: climate.set_preset_mode
    data:
      preset_mode: none
    target:
      entity_id:
      - climate.office_heating
  mode: single
- id: '1656501790704'
  alias: "\U0001F321️ Office Heater Timer - On"
  description: ''
  trigger:
  - platform: time
    at: input_datetime.office_heater_on_time
  condition:
  - condition: state
    entity_id: climate.office_heating
    state: heat
  - condition: state
    entity_id: input_boolean.office_heater_timer
    state: 'on'
  action:
  - service: climate.set_preset_mode
    data:
      preset_mode: sleep
    target:
      entity_id:
      - climate.office_heating
  mode: single
- id: '1656501837599'
  alias: "\U0001F321️️ Office Heater - Sleep Mode Slider"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - climate.office_heating
    attribute: preset_mode
    to: sleep
  condition: []
  action:
  - service: climate.set_temperature
    target:
      entity_id: climate.office_heating
    data:
      temperature: '{{ states("input_number.office_heater_timer_temp") }}'
  mode: single
- id: '1656502769828'
  alias: "\U0001F321️ Guest Room Heater Timer - Off "
  description: ''
  trigger:
  - platform: time
    at: input_datetime.guest_room_heater_off_time
  condition:
  - condition: state
    entity_id: climate.guest_room_heating
    state: sleep
    attribute: preset_mode
  - condition: state
    entity_id: input_boolean.guest_room_heater_timer
    state: 'on'
  action:
  - service: climate.set_preset_mode
    data:
      preset_mode: none
    target:
      entity_id:
      - climate.guest_room_heating
  mode: single
- id: '1656502830840'
  alias: "\U0001F321️ Guest Room Heater Timer - On"
  description: ''
  trigger:
  - platform: time
    at: input_datetime.guest_room_heater_on_time
  condition:
  - condition: state
    entity_id: climate.guest_room_heating
    state: heat
  - condition: state
    entity_id: input_boolean.guest_room_heater_timer
    state: 'on'
  action:
  - service: climate.set_preset_mode
    data:
      preset_mode: sleep
    target:
      entity_id:
      - climate.guest_room_heating
  mode: single
- id: '1656502879082'
  alias: "\U0001F321️️ Guest Room Heater - Sleep Mode Slider"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - climate.guest_room_heating
    attribute: preset_mode
    to: sleep
  condition: []
  action:
  - service: climate.set_temperature
    target:
      entity_id: climate.guest_room_heating
    data:
      temperature: '{{ states("input_number.guest_room_heater_timer_temp") }}'
  mode: single
- id: '1672126071304'
  alias: ❄️ Turn off AC when all zones off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.daikin_ac_living
    - switch.daikin_ac_bedroom
    - switch.daikin_ac_dot_office
    - switch.daikin_ac_paul_office
    - switch.daikin_ac_kitchen
    - switch.daikin_ac_guest
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 10
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: switch.daikin_ac_living
      state: 'off'
    - condition: state
      entity_id: switch.daikin_ac_bedroom
      state: 'off'
    - condition: state
      entity_id: switch.daikin_ac_dot_office
      state: 'off'
    - condition: state
      entity_id: switch.daikin_ac_paul_office
      state: 'off'
    - condition: state
      entity_id: switch.daikin_ac_kitchen
      state: 'off'
    - condition: state
      entity_id: switch.daikin_ac_guest
      state: 'off'
  action:
  - device_id: b234bba5e861252c22c666fd42dc0f0b
    domain: climate
    entity_id: climate.daikin_ac
    type: set_hvac_mode
    hvac_mode: 'off'
  mode: single
- id: '1673999081128'
  alias: ❄️ Turn on AC when any switch turns on
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.daikin_ac_any_rooms_on
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 10
  condition:
  - condition: state
    entity_id: climate.daikin_ac
    attribute: hvac_action
    state: 'off'
  action:
  - device_id: b234bba5e861252c22c666fd42dc0f0b
    domain: climate
    entity_id: climate.daikin_ac
    type: set_hvac_mode
    hvac_mode: cool
  mode: single
- id: '1674028570229'
  alias: Testing 1
  description: ''
  trigger:
  - platform: event
    event_type: state_changed
    event_data:
      data:
        entity_id: switch.daikin_ac_bedroom
  condition: []
  action: []
  mode: single
- id: '1674084251043'
  alias: Update OpenUV
  description: Update UV indexes
  trigger:
  - platform: time_pattern
    minutes: /6
  condition:
  - condition: sun
    after: sunrise
    before: sunset
    before_offset: +00:40:00
  - condition: template
    value_template: "{{\n  state_attr('automation.update_openuv', 'last_triggered')
      == None\n  or (\n    now() - state_attr('automation.update_openuv', 'last_triggered')\n
      \ ) >= timedelta(hours = 0, minutes = 36)\n}}"
  action:
  - service: homeassistant.update_entity
    target:
      entity_id:
      - binary_sensor.protection_window
      - sensor.current_uv_index
    data: {}
- id: '1674108881656'
  alias: "\U0001F518 Attic Light Switch"
  description: ''
  use_blueprint:
    path: cow/aqara-buttons-all-in-one-zigbee2mqtt.yaml
    input:
      action_sensor: sensor.attic_light_switch_action
      single_action:
      - service: light.toggle
        data: {}
        target:
          entity_id:
          - light.attic_light
      double_action: []
- id: '1675227458252'
  alias: ❄️ Remember Daikin AC last active mode
  description: ''
  trigger:
  - entity_id:
    - sensor.daikin_ac_active_mode
    platform: state
  condition:
  - condition: template
    value_template: '{{ trigger.to_state.state not in ["off"]  }}'
  action:
  - service: input_text.set_value
    data:
      value: '{{trigger.to_state.state}}'
    target:
      entity_id: input_text.daikin_ac_last_active_mode
  mode: single
