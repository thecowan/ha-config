sonos_say:
  alias: Sonos TTS script
  sequence:
  - service: sonos.snapshot
    data_template:
      entity_id: '{{ sonos_entity }}'
  - service: media_player.unjoin
    data_template:
      entity_id: '{{ sonos_entity }}'
  - service: media_player.volume_set
    data_template:
      entity_id: '{{ sonos_entity }}'
      volume_level: '{{ volume }}'
  - service: tts.google_say
    data_template:
      entity_id: '{{ sonos_entity }}'
      message: '{{ message }}'
  - delay: '{{ delay }}'
  - service: sonos.restore
    data_template:
      entity_id: '{{ sonos_entity }}'
sonos_get_home:
  alias: Sonos Get Home
  sequence:
  - service: script.sonos_join_all
  - service: script.sonos_play_matching
    data_template:
      entity_id: media_player.office
      match: \U0001F3E0
sonos_romance:
  alias: Sonos Romantic Music
  sequence:
  - service: script.sonos_join_all
  - service: script.sonos_play_matching
    data_template:
      entity_id: media_player.office
      match: \U0001F49C
sonos_sleep:
  alias: Sonos Sleep Music
  sequence:
  - service: media_player.unjoin
    data:
      entity_id: media_player.master_bedroom
  - service: media_player.volume_set
    data:
      volume_level: 0.05
    target:
      entity_id: media_player.master_bedroom
  - service: media_player.shuffle_set
    data:
      entity_id: media_player.master_bedroom
      shuffle: true
  - service: script.sonos_play_matching
    data:
      entity_id: media_player.master_bedroom
      match: "üí§"
  mode: single
sonos_play_non_matching:
  alias: Sonos Play Non-Matching
  description: Randomly choose and play a Sonos favourite which does NOT contain a particular character
  fields:
    entity_id:
      name: "Entity ID"
      description: "The device to target"
      example: "media_player.office"
      required: true
      selector:
        entity:
          integration: "sonos"
          domain: "media_player"
    match:
      name: "Match String"
      description: "The string to avoid"
      example: "Home"
      required: true
      selector:
        text:
  sequence:
  - service: media_player.play_media
    data_template:
      entity_id: '{{ entity_id }}'
      media_content_type: "favorite_item_id"
      media_content_id: '{{ state_attr("sensor.sonos_favorites", "items") | discard_values(match) | random_entry | first }}'
sonos_play_matching:
  alias: Sonos Play Matching
  description: Randomly choose and play a Sonos favourite containing a particular character
  fields:
    entity_id:
      name: "Entity ID"
      description: "The device to target"
      example: "media_player.office"
      required: true
      selector:
        entity:
          integration: "sonos"
          domain: "media_player"
    match:
      name: "Match String"
      description: "The string to match"
      example: "Home"
      required: true
      selector:
        text:
  sequence:
  - service: media_player.play_media
    data_template:
      entity_id: '{{ entity_id }}'
      media_content_type: "favorite_item_id"
      media_content_id: '{{ state_attr("sensor.sonos_favorites", "items") | keep_values(match) | random_entry | first }}'
sonos_join_all:
  alias: Sonos Join All
  sequence:
  - service: media_player.join
    data:
      entity_id: media_player.office
      group_members:
      - media_player.kitchen
      - media_player.master_bedroom
      - media_player.guest_room
sonos_ungroup_and_play:
  alias: Sonos Ungroup & Play
  sequence:
  - service: media_player.unjoin
    data_template:
      entity_id: '{{ sonos_entity }}'
  - service: media_player.volume_set
    data_template:
      entity_id: '{{ sonos_entity }}'
      volume_level: '{{ volume }}'
  - service: media_player.select_source
    data_template:
      entity_id: '{{ sonos_entity }}'
      source: '{{ source_name }}'
shower_paul:
  alias: 'Shower: Paul'
  sequence:
  - data:
      sonos_entity: media_player.bathroom
      source_name: I'm feeling lucky (Paul) üè†üöø
      volume: 0.5
    service: script.sonos_ungroup_and_play
pause_all_sonos:
  alias: Pause All Sonos
  sequence:
  - service: media_player.media_pause
    data:
      entity_id: group.all_sonos
pause_all_media:
  alias: Pause All Media
  sequence:
  - service: media_player.media_pause
    data:
      entity_id: all
set_cat_flap_state:
  alias: Set Cat Flap State
  fields:
    target_state:
      name: Target State
      required: true
      description: The aggregate state of the cat flap (all_locked, all_unlocked,
        keep_inside, keep_outside, keep_in_bedroom, keep_in_office)
      example: keep_in_bedroom
  sequence:
  - service: system_log.write
    data:
      message: Bedroom to {% if target_state in ["all_locked"] -%} locked_all {%-
        elif target_state in ["all_unlocked"] -%} unlocked {%- elif target_state in
        ["keep_outside", "keep_in_office"] -%} locked_out {%- elif target_state in
        ["keep_inside", "keep_in_bedroom"] -%} locked_in {%- else -%} ??? {%- endif
        %}
  - service: surepetcarebeta.set_lock_state
    data:
      flap_id: 675555
      lock_state: '{% if target_state in ["all_locked"] -%} locked_all {%- elif target_state
        in ["all_unlocked"] -%} unlocked {%- elif target_state in ["keep_outside",
        "keep_in_office"] -%} locked_out {%- elif target_state in ["keep_inside",
        "keep_in_bedroom"] -%} locked_in {%- else -%} ??? {%- endif %}'
  - service: surepetcarebeta.set_lock_state
    data:
      flap_id: 671120
      lock_state: '{% if target_state in ["all_locked"] -%} locked_all {%- elif target_state
        in ["all_unlocked"] -%} unlocked {%- elif target_state in ["keep_outside",
        "keep_in_bedroom"] -%} locked_out {%- elif target_state in ["keep_inside",
        "keep_in_office"] -%} locked_in {%- else -%} ??? {%- endif %}'
  mode: single
  icon: mdi:cat
  description: Bulk set cat flap state
