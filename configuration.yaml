homeassistant:
  # Name of the location where Home Assistant is running
  name: Dairy
  # Location required to calculate the time the sun rises and sets
  latitude: !secret latitude
  longitude: !secret longitude
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: !secret elevation
  # metric for Metric, imperial for Imperial
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: Australia/Melbourne
  # Customization file
  customize: !include customize.yaml
  auth_providers:
    - type: homeassistant

# Enables configuration UI
config:

http:
  cors_allowed_origins: !secret cors_allowed_origins

# Checks for available updates
# Note: This component will send some information about your system to
# the developers to assist with development of Home Assistant.
# For more information, please see:
# https://home-assistant.io/blog/2016/10/25/explaining-the-updater/
updater:
  # Optional, allows Home Assistant developers to focus on popular components.
  # include_used_components: true

# Discover some devices automatically
discovery:

# Allows you to issue voice commands from the frontend in enabled browsers
conversation:

# Enables support for tracking state changes over time
history:

# View all events in a logbook
logbook:

# Enables a map showing the location of tracked devices
map:

# Track the sun
sun:

# Weather prediction
sensor:
  - platform: alpha_vantage
    api_key: !secret alpha_vantage_api_key
    symbols:
    - symbol: GOOG
      name: Google C
    foreign_exchange:
    - name: AUD_USD
      from: AUD
      to: USD
  - platform: lastfm
    api_key: !secret lastfm_api_key
    users: !secret lastfm_users
  - platform: season
    type: astronomical
  - platform: moon
  - platform: bom
    station: !secret bom_station_id
    name: !secret bom_station_name
    monitored_conditions:
      - apparent_t
      #- cloud
      #- cloud_base_m
      #- cloud_oktas
      #- cloud_type_id
      #- cloud_type
      - delta_t
      - gust_kmh
      #- gust_kt
      - air_temp
      #- dewpt
      - press
      #- press_qnh
      #- press_msl
      #- press_tend
      - rain_trace
      - rel_hum
      #- sea_state
      #- swell_dir_worded
      #- swell_height
      #- swell_period
      #- vis_km
      #- weather
      - wind_dir
      - wind_spd_kmh
      #- wind_spd_kt
  - platform: template
    sensors:
      bedroom_right_power:
        friendly_name: 'Guest Room Right Power'
        unit_of_measurement: 'W'
        value_template: '{{ states.switch.plug_guestroom_right.attributes.load_power|int }}'
      bedroom_left_power:
        friendly_name: 'Bedroom Left Power'
        unit_of_measurement: 'W'
        value_template: '{{ states.switch.plug_bedroom_left.attributes.load_power|int }}'
      beerfridge_power:
        friendly_name: 'Beer Fridge Power'
        unit_of_measurement: 'W'
        value_template: '{{ states.switch.plug_beerfridge.attributes.load_power|int }}'
      bedroom_right_power_consumed:
        friendly_name: 'Guest Room Right Power Consumed'
        unit_of_measurement: 'Wh'
        value_template: '{{ states.switch.plug_guestroom_right.attributes.power_consumed|int }}'
      bedroom_left_power_consumed:
        friendly_name: 'Bedroom Left Power Consumed'
        unit_of_measurement: 'Wh'
        value_template: '{{ states.switch.plug_bedroom_left.attributes.power_consumed|int }}'
      beerfridge_power_consumed:
        friendly_name: 'Beer Fridge Power Consumed'
        unit_of_measurement: 'Wh'
        value_template: '{{ states.switch.plug_beerfridge.attributes.power_consumed|int }}'
      lilyfield_temperature:
        friendly_name: 'Lilyfield Temperature'
        unit_of_measurement: '°C'
        value_template: "{{ state_attr('weather.lilyfield', 'temperature') }}"
      cat_flap_cloud_state:
        friendly_name: 'Cat Flap State'
        value_template: >-
          {% if is_state("sensor.cat_flap_dots_office", "unlocked") and is_state("sensor.cat_flap_bedroom", "unlocked") -%}
            all_unlocked
          {% elif is_state("sensor.cat_flap_dots_office", "locked_all") and is_state("sensor.cat_flap_bedroom", "locked_all") -%}
            all_locked
          {% elif is_state("sensor.cat_flap_dots_office", "locked_in") and is_state("sensor.cat_flap_bedroom", "locked_out") -%}
            keep_in_office
          {% elif is_state("sensor.cat_flap_dots_office", "locked_out") and is_state("sensor.cat_flap_bedroom", "locked_in") -%}
            keep_in_bedroom
          {% elif is_state("sensor.cat_flap_dots_office", "locked_in") and is_state("sensor.cat_flap_bedroom", "locked_in") -%}
            keep_inside
          {% elif is_state("sensor.cat_flap_dots_office", "locked_out") and is_state("sensor.cat_flap_bedroom", "locked_out") -%}
            keep_outside
          {%- else -%}
            mixed
          {%- endif %}
      tabitha_last_door:
        friendly_name: 'Tabitha Last Door'
        value_template: '{% if state_attr("binary_sensor.pet_tabitha", "status") == None -%}Unknown{%- elif state_attr("binary_sensor.pet_tabitha", "status").activity.device_id == 675555 -%}Bedroom{%- else -%}Office{%- endif %}'
      tamara_last_door:
        friendly_name: 'Tamara Last Door'
        value_template: '{% if state_attr("binary_sensor.pet_tamara", "status") == None -%}Unknown{%- elif state_attr("binary_sensor.pet_tamara", "status").activity.device_id == 675555 -%}Bedroom{%- else -%}Office{%- endif %}'
  - platform: untappd
    username: !secret untappd_username
    id: !secret untappd_id
    secret: !secret untappd_secret
  - platform: mqtt
    state_topic: "owntracks/paul/coral"
    name: "Battery Paul"
    unit_of_measurement: "%"
    value_template: '{{ value_json.batt }}'
    device_class: battery
  - platform: mqtt
    name: "BBQ Probe 1"
    state_topic: "inkbird/probe1"
    unique_id: temperature_bbq_probe1
    unit_of_measurement: "°C"
    device_class: "temperature"
    expire_after: 300
  - platform: mqtt
    name: "BBQ Probe 2"
    state_topic: "inkbird/probe2"
    unique_id: temperature_bbq_probe2
    unit_of_measurement: "°C"
    device_class: "temperature"
    expire_after: 300
  - platform: mqtt
    name: "BBQ Probe 3"
    state_topic: "inkbird/probe3"
    unique_id: temperature_bbq_probe3
    unit_of_measurement: "°C"
    device_class: "temperature"
    expire_after: 300
  - platform: mqtt
    name: "BBQ Probe 4"
    state_topic: "inkbird/probe4"
    unique_id: temperature_bbq_probe4
    unit_of_measurement: "°C"
    device_class: "temperature"
    expire_after: 300
  - platform: mqtt
    name: "BBQ Probe 5"
    state_topic: "inkbird/probe5"
    unique_id: temperature_bbq_probe5
    unit_of_measurement: "°C"
    device_class: "temperature"
    expire_after: 300
  - platform: mqtt
    name: "BBQ Probe 6"
    state_topic: "inkbird/probe6"
    unique_id: temperature_bbq_probe6
    unit_of_measurement: "°C"
    device_class: "temperature"
    expire_after: 300
  - platform: mqtt
    name: "BBQ Probe Battery"
    state_topic: "inkbird/batteryLevel"
    unique_id: battery_bbq_probe
    unit_of_measurement: "%"
    device_class: "battery"
  - platform: waqi
    token: !secret waqi_token
    locations:
      - !secret waqi_location

binary_sensor:
  - platform: linode
    nodes: !secret linode_nodes

# Text to speech
tts:
  - platform: google_translate
    service_name: google_say

# Cloud
cloud:

panel_iframe:

zone:
  - name: !secret zone_work_name
    latitude: !secret zone_work_latitude
    longitude: !secret zone_work_longitude
    radius: 500
    icon: mdi:office-building

device_tracker:
  - platform: google_maps
    username: !secret google_maps_username
    consider_home: 180
    max_gps_accuracy: 200


prometheus:

media_player:
  - platform: onkyo
    host: 10.2.2.29
    name: receiver
    sources:
      # video1_vcr_dvr_stb_dvr
      Video1: 'VCR'
      # video2_cbl_sat
      Video2: 'Sonos'
      # video3_game/tv_game_game1
      Video3: 'Dock'
      Video4: 'Video 4'
      # "video6_pc"
      Video6: 'PC'
      bd: 'Media Center'
      cd: 'TV'
      # video4_aux1
      Aux1: 'Aux'
      # fm unchanged
      # am unchanged
      "universal-port": 'Port'
  - platform: androidtv
    name: Guest Room TV
    host: 10.41.10.53


notify:
  - platform: pushbullet
    api_key: !secret pushbullet_api_key
  - name: pushover
    platform: pushover
    api_key: !secret pushover_api_key
    user_key: !secret pushover_user_key

linode:
  access_token: !secret linode_access_token

mqtt:
  broker: !secret mqtt_broker
  username: !secret mqtt_username
  password: !secret mqtt_password
  certificate: /etc/ssl/certs/ca-certificates.crt
  port: 8883

group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml

# mqtt_eventstream:
#  publish_topic: homeassistant/events/master

mqtt_statestream:
  base_topic: homeassistant
  publish_timestamps: true
  publish_attributes: true


var:
  receiver_last_state:
    friendly_name: Receiver Last State
    initial_value: off
    restore: true
  receiver_last_volume:
    friendly_name: Receiver Last Volume
    initial_value: 0
    restore: true
  receiver_last_source:
    friendly_name: Receiver Last Source
    initial_value: none
    restore: true

light:
  - platform: switch
    name: Bedside Lamp Left
    entity_id: switch.plug_bedroom_left
  - platform: switch
    name: Guest Room Lamp Right
    entity_id: switch.plug_guestroom_right
  - platform: group
    name: Bedside Lamps
    entities:
      - light.bedside_left
      - light.bedside_right
  - platform: flux_led
    devices:
      10.41.16.16:
        name: flux_party
        mode: rgb
      10.41.16.17:
        name: flux_fairy
        mode: rgb


google_assistant:
  project_id: !secret google_assistant_project_id
  exposed_domains:
    - light
    - script
    - media_player
    - climate

lovelace:
  mode: yaml
  resources:
    - url: "https://cdn.jsdelivr.net/npm/rgb-light-card"
      type: module
    - url: '/hacsfiles/home-assistant-sun-card/home-assistant-sun-card.js'
      type: module
    - url: '/hacsfiles/battery-state-card/battery-state-card.js'
      type: module
    - url: '/hacsfiles/button-card/button-card.js'
      type: module
    - url: '/hacsfiles/mini-graph-card/mini-graph-card-bundle.js'
      type: module
    - url: '/hacsfiles/tv-card/tv-card.js'
      type: module
    - url: '/hacsfiles/mini-media-player/mini-media-player-bundle.js'
      type: module
    - url: '/hacsfiles/simple-thermostat/simple-thermostat.js'
      type: module
    - url: '/hacsfiles/lovelace-thermostat-card/main.js'
      type: module
    - url: '/hacsfiles/lovelace-thermostat-dark-card/thermostat-dark-card.js'
      type: module
    - url: '/hacsfiles/lovelace-slider-entity-row/slider-entity-row.js'
      type: module
    - url: '/hacsfiles/compass-card/compass-card.js'
      type: module
    - url: '/hacsfiles/garbage-collection-card/garbage-collection-card.js'
      type: module

input_boolean:
  guest_mode:
    name: Guest Mode
    icon: mdi:account-multiple-plus

climate:
  - platform: generic_thermostat
    name: Beer Fridge
    heater: switch.plug_beerfridge
    target_sensor: sensor.temperature_beerfridge
    min_temp: 5
    max_temp: 20
    ac_mode: true
    min_cycle_duration:
      seconds: 300
    initial_hvac_mode: "cool"
  - platform: generic_thermostat
    name: Living Room
    heater: switch.livingroom_heater
    target_sensor: sensor.temperature_livingroom
    unique_id: livingroom_heater_thermostat_zsp001b
    min_temp: 10
    max_temp: 30
    min_cycle_duration:
      seconds: 300
    initial_hvac_mode: "off"
    cold_tolerance: 0.5
  - platform: smartir
    name: "Living Room AC"
    unique_id: living_room_ac
    device_code: 1101
    controller_data: remote.guest_room_remote
    temperature_sensor: sensor.temperature_livingroom
    humidity_sensor: sensor.humidity_livingroom
  - platform: smartir
    name: "Bedroom AC"
    unique_id: bedroom_ac
    device_code: 1101
    controller_data: remote.bedroom_remote
    temperature_sensor: sensor.temperature_bedroom
    humidity_sensor: sensor.humidity_bedroom

system_health:

person:
  - name: Paul
    id: paul1
    user_id: d7f6e7ea9e2447229fdda4f8f7119869
    device_trackers:
      - device_tracker.paul_coral
      - device_tracker.pixel4xl
  - name: Dorothy
    id: dorothy1
    device_trackers:
      - device_tracker.dotties_iphone

ssdp:

zeroconf:

owntracks:
  max_gps_accuracy: 300
  waypoints: True
  waypoint_whitelist:
    - paul

zoneminder:
  - host: !secret zoneminder_host
    username: !secret zoneminder_username
    password: !secret zoneminder_password

camera:
  - platform: zoneminder
  - platform: local_file
    name: "Sydney Weather Radar"
    file_path: /config/bomgrabber/IDR714.composite.gif
  - platform: mjpeg
    name: "Office Wall Panel"
    mjpeg_url: "http://10.41.13.100:2971/camera/stream"

mobile_app:

proximity:
  home_paul:
    devices:
      device_tracker.paul_coral
    tolerance: 30

smartir:

browser_mod:
  prefix: "browser_"
  devices:
    f3e90f74-0a97b878:
      name: cow-macbookpro2
    d7a5ab3d_98918e52:
      name: wallpanel-office

input_select:
  cat_flap_state:
    name: 'Cat Flap Control'
    options:
      - 'all_unlocked'
      - 'all_locked'
      - 'keep_in_office'
      - 'keep_in_bedroom'
      - 'keep_inside'
      - 'keep_outside'
      - 'unknown'
    initial: 'unknown'
    icon: mdi:cat
